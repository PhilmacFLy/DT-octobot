C166 COMPILER V7.05, MAIN                                                                  12/05/2013 12:54:48 PAGE 1   


C166 COMPILER V7.05, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\obj\MAIN.obj
COMPILER INVOKED BY: C:\Program Files\Keil\C166\BIN\C166.EXE MAIN.C MODV2 BROWSE MODV2 DEBUG OBJECT(.\obj\MAIN.obj) 

 stmt lvl     source

*** WARNING C500 IN LINE 1 OF MAIN.C: SERIAL NUMBER EXPIRED

    1         //****************************************************************************
    2         // @Module        Project Settings
    3         // @Filename      MAIN.C
    4         // @Project       balancebot.dav
    5         //----------------------------------------------------------------------------
    6         // @Controller    Infineon XE167F-96F66
    7         //
    8         // @Compiler      Keil
    9         //
   10         // @Codegenerator 2.2
   11         //
   12         // @Description   This file contains the project initialization function.
   13         //
   14         //----------------------------------------------------------------------------
   15         // @Date          05.12.2013 12:52:41
   16         //
   17         //****************************************************************************
   18         
   19         // USER CODE BEGIN (MAIN_General,1)
   20         
   21         // USER CODE END
   22         
   23         
   24         
   25         //****************************************************************************
   26         // @Project Includes
   27         //****************************************************************************
   28         
   29         #include "MAIN.H"
   30         
   31         // USER CODE BEGIN (MAIN_General,2)
   32         
   33         #include "motor.h"
   34         #include "megatron.h"
   35         #include "sensoric.h"
   36         // USER CODE END
   37         
   38         
   39         //****************************************************************************
   40         // @Macros
   41         //****************************************************************************
   42         
   43         // USER CODE BEGIN (MAIN_General,3)
   44         
   45         // USER CODE END
   46         
   47         
   48         //****************************************************************************
   49         // @Defines
   50         //****************************************************************************
   51         
   52         // USER CODE BEGIN (MAIN_General,4)
   53         
   54         // USER CODE END
C166 COMPILER V7.05, MAIN                                                                  12/05/2013 12:54:48 PAGE 2   

   55         
   56         
   57         //****************************************************************************
   58         // @Typedefs
   59         //****************************************************************************
   60         
   61         // USER CODE BEGIN (MAIN_General,5)
   62         
   63         // USER CODE END
   64         
   65         
   66         //****************************************************************************
   67         // @Imported Global Variables
   68         //****************************************************************************
   69         
   70         // USER CODE BEGIN (MAIN_General,6)
   71         
   72         // USER CODE END
   73         
   74         
   75         //****************************************************************************
   76         // @Global Variables
   77         //****************************************************************************
   78         
   79         // USER CODE BEGIN (MAIN_General,7)
   80         volatile unsigned char timerevent = 0;
   81         // USER CODE END
   82         
   83         
   84         //****************************************************************************
   85         // @External Prototypes
   86         //****************************************************************************
   87         
   88         // USER CODE BEGIN (MAIN_General,8)
   89         
   90         // USER CODE END
   91         
   92         
   93         //****************************************************************************
   94         // @Prototypes Of Local Functions
   95         //****************************************************************************
   96         
   97         // USER CODE BEGIN (MAIN_General,9)
   98         
   99         // USER CODE END
  100         
  101         
  102         //****************************************************************************
  103         // @Function      void MAIN_vInit(void) 
  104         //
  105         //----------------------------------------------------------------------------
  106         // @Description   This function initializes the microcontroller.
  107         //
  108         //----------------------------------------------------------------------------
  109         // @Returnvalue   None
  110         //
  111         //----------------------------------------------------------------------------
  112         // @Parameters    None
  113         //
  114         //----------------------------------------------------------------------------
  115         // @Date          05.12.2013
  116         //
C166 COMPILER V7.05, MAIN                                                                  12/05/2013 12:54:48 PAGE 3   

  117         //****************************************************************************
  118         
  119         // USER CODE BEGIN (Init,1)
  120         
  121         // USER CODE END
  122         
  123         void MAIN_vInit(void)
  124         {
  125  1        // USER CODE BEGIN (Init,2)
  126  1      
  127  1        // USER CODE END
  128  1      
  129  1        //   globally disable interrupts
  130  1        PSW_IEN        =  0;          
  131  1      
  132  1      
  133  1        ///  -----------------------------------------------------------------------
  134  1        ///  Configuration of the System Clock:
  135  1        ///  -----------------------------------------------------------------------
  136  1        ///  - VCO clock used, input clock is connected
  137  1        ///  - input frequency is 8,00 MHz
  138  1        ///  - system clock is 66.00 MHz
  139  1      
  140  1        MAIN_vUnlockProtecReg();     // unlock write security
  141  1      
  142  1        MAIN_vChangeFreq();          // load PLL control register
  143  1      
  144  1        //   -----------------------------------------------------------------------
  145  1        //   Initialization of the Peripherals:
  146  1        //   -----------------------------------------------------------------------
  147  1      
  148  1        //   initializes the Parallel Ports
  149  1        IO_vInit();
  150  1      
  151  1        //   initializes the General Purpose Timer Unit (GPT1)
  152  1        GPT1_vInit();
  153  1      
  154  1        //   initializes the General Purpose Timer Unit (GPT2)
  155  1        GPT2_vInit();
  156  1      
  157  1        //   initializes the Capture / Compare Unit 60 (CCU60)
  158  1        CCU60_vInit();
  159  1      
  160  1        //   initializes the Analog / Digital Converter  (ADC0)
  161  1        ADC0_vInit();
  162  1      
  163  1      
  164  1        //   -----------------------------------------------------------------------
  165  1        //   Initialization of the Bank Select registers:
  166  1        //   -----------------------------------------------------------------------
  167  1      
  168  1      
  169  1        // USER CODE BEGIN (Init,3)
  170  1      
  171  1        // USER CODE END
  172  1      
  173  1        MAIN_vLockProtecReg();       // lock write security
  174  1      
  175  1        //   globally enable interrupts
  176  1        PSW_IEN        =  1;          
  177  1      
  178  1      } //  End of function MAIN_vInit
C166 COMPILER V7.05, MAIN                                                                  12/05/2013 12:54:48 PAGE 4   

  179         
  180         
  181         //****************************************************************************
  182         // @Function      void MAIN_vUnlockProtecReg(void) 
  183         //
  184         //----------------------------------------------------------------------------
  185         // @Description   This function makes it possible to write one protected 
  186         //                register.
  187         //
  188         //----------------------------------------------------------------------------
  189         // @Returnvalue   None
  190         //
  191         //----------------------------------------------------------------------------
  192         // @Parameters    None
  193         //
  194         //----------------------------------------------------------------------------
  195         // @Date          05.12.2013
  196         //
  197         //****************************************************************************
  198         
  199         // USER CODE BEGIN (UnlockProtecReg,1)
  200         
  201         // USER CODE END
  202         
  203         void MAIN_vUnlockProtecReg(void)
  204         {
  205  1        uword uwPASSWORD;
  206  1      
  207  1          SCU_SLC = 0xAAAA;                   // command 0
  208  1          SCU_SLC = 0x5554;                   // command 1
  209  1      
  210  1          uwPASSWORD = SCU_SLS & 0x00FF;
  211  1          uwPASSWORD = (~uwPASSWORD) & 0x00FF;
  212  1      
  213  1          SCU_SLC = 0x9600 | uwPASSWORD;      // command 2
  214  1          SCU_SLC = 0x0000;                   // command 3
  215  1      
  216  1      } //  End of function MAIN_vUnlockProtecReg
  217         
  218         
  219         //****************************************************************************
  220         // @Function      void MAIN_vLockProtecReg(void) 
  221         //
  222         //----------------------------------------------------------------------------
  223         // @Description   This function makes it possible to lock one protected 
  224         //                register.
  225         //
  226         //----------------------------------------------------------------------------
  227         // @Returnvalue   None
  228         //
  229         //----------------------------------------------------------------------------
  230         // @Parameters    None
  231         //
  232         //----------------------------------------------------------------------------
  233         // @Date          05.12.2013
  234         //
  235         //****************************************************************************
  236         
  237         // USER CODE BEGIN (LockProtecReg,1)
  238         
  239         // USER CODE END
  240         
C166 COMPILER V7.05, MAIN                                                                  12/05/2013 12:54:48 PAGE 5   

  241         void MAIN_vLockProtecReg(void)
  242         {
  243  1        uword uwPASSWORD;
  244  1      
  245  1          SCU_SLC = 0xAAAA;                   // command 0
  246  1          SCU_SLC = 0x5554;                   // command 1
  247  1      
  248  1          uwPASSWORD = SCU_SLS & 0x00FF;
  249  1          uwPASSWORD = (~uwPASSWORD) & 0x00FF;
  250  1      
  251  1          SCU_SLC = 0x9600 | uwPASSWORD;      // command 2
  252  1          SCU_SLC = 0x1800;                   // command 3; new PASSWOR is 0x00
  253  1      
  254  1          uwPASSWORD = SCU_SLS & 0x00FF;
  255  1          uwPASSWORD = (~uwPASSWORD) & 0x00FF;
  256  1          SCU_SLC = 0x8E00 | uwPASSWORD;      // command 4
  257  1      
  258  1      } //  End of function MAIN_vLockProtecReg
  259         
  260         
  261         //****************************************************************************
  262         // @Function      void MAIN_vChangeFreq(void) 
  263         //
  264         //----------------------------------------------------------------------------
  265         // @Description   This function is used to select the external crystal and
  266         //                configure the system frequency to 80Mhz/66Mhz.
  267         //
  268         //----------------------------------------------------------------------------
  269         // @Returnvalue   None
  270         //
  271         //----------------------------------------------------------------------------
  272         // @Parameters    None
  273         //
  274         //----------------------------------------------------------------------------
  275         // @Date          05.12.2013
  276         //
  277         //****************************************************************************
  278         
  279         // USER CODE BEGIN (ChangeFreq,1)
  280         
  281         // USER CODE END
  282         
  283         void MAIN_vChangeFreq(void)
  284         {
  285  1        SCS_SwitchToHighPrecBandgap();
  286  1      
  287  1        //For application and internal application resets, the complete PLL configuration could be avoided
  288  1        //The entry from application resets and internal application reset is covered in the following different
             -iation
  289  1        //in int/ext clock in lock/unlocked state.
  290  1      
  291  1        if  ((SCU_PLLSTAT & 0x0004) == 0x0004)             // fR derived from Internal clock
  292  1              {
  293  2                  //Normal startup state during boot and the clock
  294  2                  //has to be in the next step configured on the external crystal
  295  2                  //use XTAL/VCO, count XTAL clock
  296  2      
  297  2                  SCS_StartXtalOsc(1);                     // Starts the crystal oscillator
  298  2                  SCS_SwitchSystemClock(1);                // System clock is increased to target speed (80/66 M
             -Hz)
  299  2      
  300  2              }
C166 COMPILER V7.05, MAIN                                                                  12/05/2013 12:54:48 PAGE 6   

  301  1      
  302  1        else                                               // fR derived from external crystal clock
  303  1              {
  304  2                  if ((SCU_PLLSTAT & 0x1009) == 0x1009)    // fR derived from external crystal clock + VCO is lo
             -cked
  305  2                  {
  306  3                     //usually after an application reset where clock need not be configured again.
  307  3                     //check K2/P/N values and decide whether these values have to be adapted based on applicati
             -on needs.
  308  3                     NOP();
  309  3                     //usually the PLL losss of Lock TRAP schould be enabled here.
  310  3                  }
  311  2                  else                                     //fR derived from external crystal clock + VCO is not
             - locked
  312  2      
  313  2                  {
  314  3                     //estimate the K1 value and the current frequency
  315  3                     //reduce K2/P/N values in steps so that the frequency
  316  3                     //jumps is limited to 20MHz or factor of 5 whichever is minimum
  317  3                     NOP();
  318  3                  }
  319  2      
  320  2      
  321  2              }
  322  1      
  323  1      } //  End of function MAIN_vChangeFreq
  324         
  325         
  326         //****************************************************************************
  327         // @Function      void main(void) 
  328         //
  329         //----------------------------------------------------------------------------
  330         // @Description   This is the main function.
  331         //
  332         //----------------------------------------------------------------------------
  333         // @Returnvalue   None
  334         //
  335         //----------------------------------------------------------------------------
  336         // @Parameters    None
  337         //
  338         //----------------------------------------------------------------------------
  339         // @Date          05.12.2013
  340         //
  341         //****************************************************************************
  342         
  343         // USER CODE BEGIN (Main,1)
  344         
  345         // USER CODE END
  346         
  347         void main(void)
  348         {
  349  1        // USER CODE BEGIN (Main,2)
  350  1        signed int ret_left;
  351  1        signed int ret_right;
  352  1        signed int gyrovalue;
  353  1        unsigned char ledvalue;
  354  1        // USER CODE END
  355  1      
  356  1        MAIN_vInit();
  357  1      
  358  1        // USER CODE BEGIN (Main,3)
  359  1      
C166 COMPILER V7.05, MAIN                                                                  12/05/2013 12:54:48 PAGE 7   

  360  1        // USER CODE END
  361  1      
  362  1        while(1)
  363  1        {
  364  2      
  365  2         // USER CODE BEGIN (Main,4)
  366  2         while(0 == timerevent);
  367  2         timerevent = 0;
  368  2      
  369  2         // start reading the data, they will be get then
  370  2         ReadSensorData();
  371  2         gyrovalue = ReadSpinValue();
  372  2         ledvalue = ReadSpinValueRaw();
  373  2         P10_OUT = ledvalue;
  374  2         // do some kind of stuff
  375  2         ret_left = 0;
  376  2         ret_right = 0;
  377  2         SetMotorSpeeds(&ret_left, &ret_right);
  378  2         // set motor speed
  379  2         //SetMotorSpeedsNoReturn(links_p, rechts_p);
  380  2         // faehrt vorwärts hoffentlich
  381  2         // und au langsam
  382  2         //SetMotorSpeedsNoReturn(-40, -40);//20, 20);
  383  2         // USER CODE END
  384  2      
  385  2        }
  386  1      
  387  1      } //  End of function main
  388         
  389         
  390         
  391         // USER CODE BEGIN (MAIN_General,10)
  392         
  393         // USER CODE END
  394         


MODULE INFORMATION:   INITIALIZED  UNINITIALIZED
  CODE SIZE        =         256     --------
  NEAR-CONST SIZE  =    --------     --------
  FAR-CONST SIZE   =    --------     --------
  HUGE-CONST SIZE  =    --------     --------
  XHUGE-CONST SIZE =    --------     --------
  NEAR-DATA SIZE   =           1     --------
  FAR-DATA SIZE    =    --------     --------
  XHUGE-DATA SIZE  =    --------     --------
  IDATA-DATA SIZE  =    --------     --------
  SDATA-DATA SIZE  =    --------     --------
  BDATA-DATA SIZE  =    --------     --------
  HUGE-DATA SIZE   =    --------     --------
  BIT SIZE         =    --------     --------
  INIT'L SIZE      =           6     --------
END OF MODULE INFORMATION.


C166 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
